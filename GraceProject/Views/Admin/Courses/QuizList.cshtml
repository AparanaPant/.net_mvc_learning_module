@model IEnumerable<GraceProject.Models.Quiz>
@{
    Layout = "~/Views/Shared/_StudentLayout.cshtml";
    ViewBag.Title = "Quizzes";
}

<h2>Quizzes</h2>
<a href="@Url.Action("Create", "Quiz", new { CourseID = ViewBag.CourseID })" class="btn btn-success">
    ➕ Create New Quiz
</a>

@if (!Model.Any())
{
    <p>No quizzes available.</p>
}
else
{
    <ul class="list-group">
        @foreach (var quiz in Model)
        {
            var quizTaken = ViewBag.QuizTakenStatus != null && ((Dictionary<int, bool>)ViewBag.QuizTakenStatus).ContainsKey(quiz.QuizId)
            ? ((Dictionary<int, bool>)ViewBag.QuizTakenStatus)[quiz.QuizId]
            : false;

            <li class="list-group-item d-flex justify-content-between align-items-center">
                <span>@quiz.Title</span> <!-- Quiz title is now plain text -->

                <div>
                    <a href="~/Quiz/Details/@quiz.QuizId" class="btn btn-primary">View</a>
                    <a href="@Url.Action("Edit", "Quiz", new { id = quiz.QuizId, userType = "admin" })"
                       class="btn btn-secondary @(quizTaken ? "disabled" : "")">
                        Edit
                    </a>
                    <button type="button" class="btn btn-danger @(quizTaken ? "disabled" : "")"
                            onclick="confirmDelete('@quiz.QuizId')" @(quizTaken ? "disabled" : "")>
                        Delete
                    </button>
                </div>
            </li>
        }
    </ul>
}

@section Scripts {
    <script>
        function confirmDelete(quizId) {
            if (confirm('Are you sure you want to delete this quiz?')) {
                $.ajax({
                    url: '@Url.Action("Delete", "Quiz")/' + quizId,
                    type: 'POST',
                    success: function (result) {
                        location.reload();
                    },
                    error: function (xhr, status, error) {
                        alert('An error occurred while trying to delete the quiz: ' + error);
                    }
                });
            }
        }
    </script>
}
